(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function l(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(t){if(t.ep)return;t.ep=!0;const n=l(t);fetch(t.href,n)}})();document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("timeChart").getContext("2d");const a=document.createElement("div");a.textContent="Loading data...",a.style.textAlign="center",a.style.marginTop="20px",document.querySelector(".chart-container").appendChild(a);let m=[],l=null,u=null;function t(){const n=document.getElementById("jobCategory").value,c=document.getElementById("timePeriod").value,r=moment();let s;switch(c){case"week":s=r.clone().subtract(1,"week");break;case"month":s=r.clone().subtract(1,"month");break;case"3months":s=r.clone().subtract(3,"months");break;case"6months":s=r.clone().subtract(6,"months");break;case"year":s=r.clone().subtract(1,"year");break;case"2years":s=r.clone().subtract(2,"years");break;default:s=r.clone().subtract(6,"months")}const d=m.filter(e=>{const o=e.job_category===n,b=moment(e.created_at).isAfter(s);return o&&b});d.sort((e,o)=>new Date(e.created_at)-new Date(o.created_at));const g=d.map(e=>e.duration/60),f=g.length?g.reduce((e,o)=>e+o,0)/g.length:0,y=[...g].sort((e,o)=>e-o),h=g.length?y[Math.floor(y.length*.95)]:0;document.getElementById("stat-avg").textContent=f.toFixed(1),document.getElementById("stat-p95").textContent=h.toFixed(1),document.getElementById("stat-total").textContent=d.length,l&&l.destroy();const C=document.getElementById("timeChart").getContext("2d");l=new Chart(C,{type:"line",data:{labels:d.map(e=>moment(e.created_at).format("MMM D, YYYY")),datasets:[{label:"Job Duration (minutes)",data:g,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,pointRadius:2,pointHoverRadius:6,fill:!0,tension:.3}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{ticks:{color:"#94a3b8",maxRotation:0,autoSkip:!0,maxTicksLimit:12},grid:{color:"rgba(255, 255, 255, 0.05)"}},y:{beginAtZero:!0,ticks:{color:"#94a3b8"},grid:{color:"rgba(255, 255, 255, 0.05)"}}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.9)",padding:12,cornerRadius:8,callbacks:{label:e=>{const o=e.dataIndex,b=d[o];return`[${b.branch}] ${b.display_title}: ${e.raw.toFixed(1)} mins`}}},zoom:{pan:{enabled:!0,mode:"x"},zoom:{wheel:{enabled:!0},pinch:{enabled:!0},mode:"x",onZoomComplete:()=>{document.getElementById("resetZoom").style.display="block"}}}},onClick:(e,o)=>{if(o.length>0){const b=o[0].index;window.open(d[b].url,"_blank")}}}}),u&&u.destroy();const i={};d.forEach(e=>{const o=moment(e.created_at).format("YYYY-MM");i[o]||(i[o]={total:0,count:0}),i[o].total+=e.duration/60,i[o].count+=1});const p=Object.keys(i).sort(),x=p.map(e=>i[e].total/i[e].count),E=p.map(e=>moment(e,"YYYY-MM").format("MMM YYYY")),k=document.getElementById("monthlyChart").getContext("2d");u=new Chart(k,{type:"bar",data:{labels:E,datasets:[{label:"Avg Duration (mins)",data:x,backgroundColor:"rgba(249, 115, 22, 0.6)",borderColor:"#f97316",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{x:{ticks:{color:"#94a3b8"},grid:{display:!1}},y:{beginAtZero:!0,ticks:{color:"#94a3b8"},grid:{color:"rgba(255, 255, 255, 0.05)"}}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(15, 23, 42, 0.9)",callbacks:{label:e=>`Avg: ${e.raw.toFixed(1)} mins`}}}}})}try{m=await(await fetch("data.json")).json(),a.remove();const c=document.getElementById("jobCategory"),r=document.getElementById("timePeriod");t(),c.addEventListener("change",t),r.addEventListener("change",t),document.getElementById("resetZoom").addEventListener("click",()=>{l&&(l.resetZoom(),document.getElementById("resetZoom").style.display="none")})}catch(n){console.error("Error loading data:",n),a.textContent="Error loading data. Make sure data.json exists.",a.style.color="#ef4444"}});
